# 点光源阴影

### 知识回顾
上一个知识点中，有一个疑惑点，面剔除究竟为何能优化阴影映射算法。于是做了一波拓展

#### 最初的SM算法：

![ori_pic](图片/ori_pic.png)

理解:
>* 深度贴图 - 绘制的为物体的表面
>* 阴影计算渲染时，计算的为物体的表面

结果:

![无偏移无剪切](图片/无偏移无剪切.png)

有明显的冲突纹理。

#### 使用bias做偏移

![bias_pic](图片/bias_pic.png)

理解:
>* 加上偏移后，实际 = 物体向光源出做了一小段位移

结果:

![有偏移无剪切](图片/有偏移无剪切.png)

有上浮偏移。

#### 使用剪切的方法，取背面

![backcull_pic](图片/backcull_pic.png)

理解:
>* 使用剪切后，对于有厚度的物体，相当于选择离光源更远的一面绘制阴影

结果：

![无偏移有剪切](图片/无偏移有剪切.png)

在接合处，有光缝。

![有缝隙](图片/有缝隙.png)

#### 使用剪切后，使用负偏移

修正:
>* 缝隙的原因，对于靠近物体边界的片元，也就是靠近选择绘制深度贴图的一面，同样有

![ori_pic](图片/ori_pic.png)

初步修正，减去偏移量，结果：

![负偏移有剪切](图片/负偏移有剪切.png)

有阴影上漫的现象

![阴影上漫](图片/阴影上漫.png)

理解:
>* 当负偏移取得过大时，对于靠近选择深度贴图的光的一面，偏移量就会导致阴影。

现在的问题变成了，对于2处片元，我们应该采取不同的策略。

![Two Face Pic](图片/two_face_pic.png)

修正:
>* 记录2张深度信息，near & far
>* 观察可以发现，当 near 和 far 相接近时，则处于边角的区域，这是bias应该越小
bias的选取：
```c++
bias = min(FarDepth - NearDepth, 0.005f);
```

效果:

![双深度贴图](图片/双深度贴图.png)

![双深度贴图瑕疵](图片/双深度贴图瑕疵.png)

>* 虽然仍有瑕疵，但控制在了可以接受的范围内。

### 点光源的做法

